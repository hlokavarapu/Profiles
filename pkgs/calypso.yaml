extends: [cmake_package]
dependencies:
  build: [cmake, mpi]

#sources:
# - url: https://github.com/geodynamics/calypso.git 
#   key: git:1d20f55fd74b30f7715f875492f6a7b62f3b6274

sources:
- url: http://geodynamics.org/cig/software/calypso/calypso-{{version}}.tar.gz
  key: tar.gz:fpawsia4tmgufszm6st3ueh73ddive5w

build_stages:
- name: configure
  mode: override
  extra: ['-D CMAKE_INSTALL_PREFIX:PATH=${ARTIFACT}',
          '-D CMAKE_Fortran_COMPILER={{fortranCompiler}}',
          '-D CMAKE_DISABLE_FIND_PACKAGE_FFTW:bool=yes']

- name: install
  mode: remove

- name: postMake
  after: make
  handler: bash
  bash: |
    mkdir ${ARTIFACT}/bin
    cp -r ${BUILD}/_build/bin ${ARTIFACT}/bin
    cp -r ${BUILD}/examples ${ARTIFACT}

#- name: postInstallation
#  after: postMake 
#  handler: bash
#  bash: |
#    echo "export CALYPSO_HOME=\"${ARTIFACT}\"" >> ${HOME}/.bash_profile
#    . ${HOME}/.bash_profile


