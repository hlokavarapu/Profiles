extends: [cmake_package]
dependencies:
  build: [cmake, mpi]

sources: 
- url: http://geodynamics.org/cig/software/calypso/calypso-{{version}}.tar.gz
  key: tar.gz:fpawsia4tmgufszm6st3ueh73ddive5w

build_stages:
- name: configure
  mode: override
  extra: ['-D CMAKE_INSTALL_PREFIX:PATH=${ARTIFACT}',
          '-D CMAKE_DISABLE_FIND_PACKAGE_FFTW:bool=yes']

- name: install
  mode: remove

- name: postMake
  after: configure
  handler: bash
  bash: |
    cp -r ${BUILD}/bin ${ARTIFACT}

#- name: postInstallation
#  after: postMake 
#  handler: bash
#  bash: |
#    echo "export CALYPSO_HOME=\"${ARTIFACT}\"" >> ${HOME}/.bash_profile
#    . ${HOME}/.bash_profile


