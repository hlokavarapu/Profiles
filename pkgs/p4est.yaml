extends: [base_package]
dependencies:
  build: [openmpi]  

#sources:
#- url: http://www.p4est.org/tarball/p4est-{{p4est_version}}.tar.gz
#  key: tar.gz:ozmxzoje6tdf6defgaoomw7ycqkbdb33
  

build_stages:
- name: retrival
  after: prologue
  handler: bash
  bash: |
    mkdir _build
    cd _build
    wget http://www.p4est.org/tarball/p4est-{{p4est_version}}.tar.gz
    wget http://www.dealii.org/developer/external-libs/p4est-setup.sh
    chmod 755 p4est-setup.sh

- name: make_and_install
  after: retrival
  handler: bash
  bash: |
    ./p4est-setup.sh p4est-{{p4est_version}}.tar.gz ${ARTIFACT}

- name: postMake
  after: make_and_install
  handler: bash
  bash: | 
    rm -rf 
    cp -r ${BUILD}/_build/* ${ARTIFACT}

#- name: postInstallation
#  after: postMake 
#  handler: bash
#  bash: |
#    echo "export P4EST_HOME=\"${ARTIFACT}\"" >> ${HOME}/.bash_profile
#    . ${HOME}/.bashrc

when_build_dependency:
- prepend_path: PATH
  value: ${ARTIFACT}/FAST

